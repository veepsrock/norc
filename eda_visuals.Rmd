---
title: "eda_visuals"
output: html_document
date: "2024-01-30"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 

library(tidyverse)
library(haven)
library(janitor)
library(knitr)
library(survey)
library(scales)
# Read in data -------------------------------------------------------------------

source("002_recode.R")

# fuction for chisquare
chisq_fx <- function(demo, ind_var){

    chisq <- chisq.test(table(df[[demo]], df[[ind_var]]))
    sig <- if_else(chisq$p.value <0.05, "a significant", "not a significant")
    print(chisq)
    print(paste("There is", sig, "result between", demo, "and", ind_var))
}

# create survey object
svy <- svydesign(ids=~1, weights = ~weight, data = df)

# write function for generating survey objects
svy_fx <- function(demo, ind_var){
  svy_object <- svyby(
    formula = as.formula(paste0("~", ind_var)),
    by = as.formula(paste0("~", demo)),
    design = svy,
    FUN = svymean
  ) |> as_tibble()

}

# write function for generating plots
plot_fx <- function(demo, ind_var){
  ggplot(svy_object, aes(x=.data[[demo]], y = .data[[ind_var]], fill =  '#00BFC4')) + 
  geom_bar(stat="identity", show.legend=F) 
}

```

## How does asian origin influence the prevalence of food and nutrition security among AANHPI?


```{r asianorigin}
demo <- "asianorigin_l"
ind_var <- "fs"

chisq_fx("asianorigin_l", "fs")
svy_object<- svy_fx("asianorigin_l", "fs")

plot_fx("asianorigin_l", "fslow")


```

## How does household income influence the prevalence of food and nutrition security among AANHPI?


Did this for income level first, need to go back and reconfigure household income level

```{r income}
chisq_fx("income4", "fs")
svy_object<- svy_fx("income4", "fs")

plot_fx("income4", "fslow")
```

## How does region influence the prevalence of food and nutrition security among AANHPI?


```{r income}
chisq_fx("region4", "fs")
svy_object<- svy_fx("region4", "fs")

plot_fx("region4", "fslow")

print(unique(df$region4))
```